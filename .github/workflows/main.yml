name: Build and Deploy Resume
on:
  push:
    branches: [main]
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0  # Для работы с историей веток

      - name: Setup LaTeX
        uses: xu-cheng/texlive-action@v2
        with:
          texlive-profile: minimal
          packages: |
            collection-basic
            collection-latex
            collection-latexextra
            collection-fontsrecommended
            collection-langcyrillic
            wallpaper
            fontawesome5

      - name: Build PDF
        run: |
          cd CV
          pdflatex -interaction=nonstopmode resume.tex
          pdflatex -interaction=nonstopmode resume.tex
          pdflatex -interaction=nonstopmode resume.tex

      - name: Configure Git
        run: |
          git config --global user.name "GitHub Actions"
          git config --global user.email "actions@github.com"

      - name: Deploy to resume-pdf branch
        run: |
          cd CV
          git init
          git remote add origin https://github.com/${{ github.repository }}.git
          git fetch origin resume-pdf || git branch -m resume-pdf
          git checkout -b resume-pdf --track origin/resume-pdf || git checkout -b resume-pdf
          git rm -rf . || true
          cp ../resume.pdf .
          git add resume.pdf
          git commit -m "Auto-update: $(date +'%Y-%m-%d %H:%M')"
          git push origin resume-pdf --force
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
